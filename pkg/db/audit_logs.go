package db

import (
	"log"

	"github.com/SecurityWaffle/pentest-tracker/pkg/models"
)

func CreateAuditLog(logEntry *models.AuditLog) error {
	query := `INSERT INTO audit_logs (timestamp, action, username) VALUES ($1, $2, $3)`
	_, err := DB.Exec(query, logEntry.Timestamp, logEntry.Action, logEntry.Username)
	if err != nil {
		log.Printf("Error creating audit log: %v", err)
		return err
	}
	return nil
}

func GetAllAuditLogs() ([]models.AuditLog, error) {
	rows, err := DB.Query(`SELECT id, timestamp, action, username FROM audit_logs`)
	if err != nil {
		log.Printf("Error fetching audit logs: %v", err)
		return nil, err
	}
	defer rows.Close()

	var logs []models.AuditLog
	for rows.Next() {
		var logEntry models.AuditLog
		if err := rows.Scan(&logEntry.ID, &logEntry.Timestamp, &logEntry.Action, &logEntry.Username); err != nil {
			log.Printf("Error scanning audit log: %v", err)
			return nil, err
		}
		logs = append(logs, logEntry)
	}
	return logs, nil
}
