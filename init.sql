CREATE TABLE IF NOT EXISTS users (
    id SERIAL PRIMARY KEY,
    username TEXT NOT NULL,
    password TEXT NOT NULL,
    role TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS pentests (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    status TEXT NOT NULL,
    start_date TIMESTAMP NOT NULL,
    end_date TIMESTAMP NOT NULL,
    product_feature_name TEXT,
    stakeholders TEXT,
    jira_ticket TEXT,
    component_description TEXT,
    threat_modeling TEXT,
    reference_info TEXT, -- Renamed to avoid conflict with reserved keyword
    out_of_scope TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS findings (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    description TEXT,
    severity TEXT NOT NULL,
    status TEXT NOT NULL,
    cvss_score FLOAT,
    cvss_calculation_link TEXT,
    jira_ticket TEXT,
    recommendation TEXT,
    proof_of_concept TEXT,
    pentest_id INTEGER REFERENCES pentests(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS scope_details (
    id SERIAL PRIMARY KEY,
    pentest_id INTEGER REFERENCES pentests(id),
    activity TEXT NOT NULL,
    details TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS security_assessment_tooling (
    id SERIAL PRIMARY KEY,
    pentest_id INTEGER REFERENCES pentests(id),
    tool TEXT NOT NULL,
    purpose TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS report_templates (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS saml_settings (
    id SERIAL PRIMARY KEY,
    idp_metadata_url TEXT,
    sp_entity_id TEXT,
    sp_acs_url TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS oidc_settings (
    id SERIAL PRIMARY KEY,
    client_id TEXT,
    client_secret TEXT,
    redirect_url TEXT,
    issuer_url TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS google_drive_settings (
    id SERIAL PRIMARY KEY,
    client_id TEXT,
    client_secret TEXT,
    redirect_url TEXT,
    folder_name_template TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS jira_settings (
    id SERIAL PRIMARY KEY,
    url TEXT,
    username TEXT,
    password TEXT,
    project_key TEXT,
    issue_type TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
